{% extends "base.html" %}
{% load static %}
{% block content %}
<!-- heading section -->
<div class="d-flex align-items-center justify-content-between text-white p-3 rounded mb-4" style="background-color: #2a2f5b;">
  <h4 class="mb-0 text-white">Add Election</h4>
  <a href="{% url 'elections_list' %}" class="btn text-dark fw-semibold" style="background-color: #FFC107;">
    <i class="fa-solid fa-circle-arrow-left me-2"></i>Back
  </a>
</div>

<!-- Election Form -->
<form id="electionForm">
  <div class="mt-4 bg-white shadow p-4 rounded">
    <div class="d-flex justify-content-between">
      <h4 class="mb-0 px-2 rounded">Election Information</h4>
    </div>
    <hr>
    <div class="row">
      <div class="col-lg-6 mb-3">
        <label for="title" class="form-label">Election Title <span style="color: red;">*</span></label>
        <input type="text" id="title" class="form-control" placeholder="Election Title" required>
      </div>

      <div class="col-lg-6 mb-3">
        <label for="description" class="form-label">Description</label>
        <textarea id="description" class="form-control" placeholder="Description" rows="2"></textarea>
      </div>

      <div class="col-lg-6 mb-3">
        <label for="start_date" class="form-label">Start Date <span style="color: red;">*</span></label>
        <input type="date" id="start_date" class="form-control" required>
      </div>

      <div class="col-lg-6 mb-3">
        <label for="end_date" class="form-label">End Date <span style="color: red;">*</span></label>
        <input type="date" id="end_date" class="form-control" required>
      </div>
    </div>

    <div class="d-flex justify-content-center mt-3">
      <button type="submit" class="btn btn-primary me-2">Submit</button>
      <button type="button" class="btn btn-warning" onclick="clearElectionForm()">Clear</button>
    </div>
  </div>
</form>

<script>
  document.getElementById('electionForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const data = {
      title: document.getElementById('title').value,
      description: document.getElementById('description').value,
      start_date: document.getElementById('start_date').value,
      end_date: document.getElementById('end_date').value
    };

    try {
      const response = await fetch('/api/elections/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });

      if (response.ok) {
        alert("Election created successfully!");
        document.getElementById("electionForm").reset();
      } else {
        const error = await response.json();
        alert("Error: " + JSON.stringify(error));
      }
    } catch (err) {
      alert("Failed to connect to API");
    }
  });

  function clearElectionForm() {
    document.getElementById("electionForm").reset();
  }
</script>
{% endblock %}
